<!DOCTYPE html>
<html lang="es">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>Guia básica de Firewalld</title>
                        <link rel="stylesheet" href="https://xmonroya.github.io/theme/css/main.css" />
    <meta name="description" content="Mantener nuestros servidores seguros es crucial, y una pieza clave para lograrlo es la configuración de un firewall en cada uno. Un firewall añade..." />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="https://xmonroya.github.io/">sferoblog</a></h1>
                        <nav><ul>
                                                <li class="active"><a href="https://xmonroya.github.io/category/linux.html">Linux</a></li>
                                                <li><a href="https://xmonroya.github.io/category/lvm.html">LVM</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="https://xmonroya.github.io/guia-basica-de-firewalld.html" rel="bookmark"
             title="Permalink to Guia básica de Firewalld">Guia básica de Firewalld</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2024-04-18T10:00:00-04:00">
                Published: jue 18 abril 2024
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="https://xmonroya.github.io/author/alex-monroy.html">Alex Monroy</a>
                </address>
        <p>In <a href="https://xmonroya.github.io/category/linux.html">Linux</a>.</p>
        
</footer><!-- /.post-info -->        <p>Mantener nuestros servidores seguros es crucial, y una pieza clave para lograrlo es la configuración de un firewall en cada uno. Un firewall añade una capa de seguridad vital, protegiendonos no solo de amenazas externas sino también de posibles ataques internos.</p>
<p>Las distribuciones Linux siempre han ofrecido herramientas robustas para controlar el tráfico de red.  En este artículo, nos centraremos en Firewalld, un demonio de firewall dinámico que viene preinstalado en muchas distribuciones populares como Red Hat, CentOS, Fedora, AlmaLinux y Rocky Linux.</p>
<p>Firewall simplifica la gestión del firewall al organizar las reglas de filtrado en zonas. A estas zonas les asignamos las interfaces de red de nuestro servidor (por ejemplo eth0, enp0s3), permitiendo que el tráfico que pasa por ellas sea controlado por las reglas definidas en esa zona.</p>
<p>Una gran ventaja de Firewalld es su capacidad para realizar cambios de forma dinámica, lo que significa que puedes modificar las reglas del firewall sin interrumpir el tráfico de red que ya está fluyendo.</p>
<p>Veamos cómo gestionar Firewalld usando el comando de línea de comandos <strong>firewall-cmd</strong>.</p>
<h2>Verificando el estado y gestionando Firewalld</h2>
<p>Antes de empezar a configurar, es fundamental saber si Firewalld está funcionando y cómo controlarlo. En sistemas Linux modernos, usamos el comando <strong>systemctl</strong> para interactuar con los servicios.</p>
<ol>
<li>¿Cómo determinar si Firewalld está activo?</li>
</ol>
<p>Puedes verificar el estado de Firewalld de dos maneras:
a) Usando systemctl status (más detallado):</p>
<p>Este comando te da una visión completa del estado del servicio Firewalld.</p>
<div class="highlight"><pre><span></span><code>systemctl<span class="w"> </span>status<span class="w"> </span>firewalld<span class="sb">```</span>

Si<span class="w"> </span>Firewalld<span class="w"> </span>está<span class="w"> </span>activo<span class="w"> </span>y<span class="w"> </span>funcionando,<span class="w"> </span>verás<span class="w"> </span>una<span class="w"> </span>salida<span class="w"> </span>similar<span class="w"> </span>a<span class="w"> </span>esta,<span class="w"> </span>donde<span class="w"> </span>**Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span>**<span class="w"> </span>indica<span class="w"> </span>que<span class="w"> </span>está<span class="w"> </span>en<span class="w"> </span>ejecución<span class="w"> </span>y<span class="w"> </span>**enabled**<span class="w"> </span>significa<span class="w"> </span>que<span class="w"> </span>se<span class="w"> </span>iniciará<span class="w"> </span>automáticamente<span class="w"> </span>con<span class="w"> </span>el<span class="w"> </span>sistema.


<span class="sb">```</span>Bash
<span class="w">      </span>●<span class="w"> </span>firewalld.service<span class="w"> </span>-<span class="w"> </span>firewalld<span class="w"> </span>-<span class="w"> </span>dynamic<span class="w"> </span>firewall<span class="w"> </span>daemon
<span class="w">      </span>Loaded:<span class="w"> </span>loaded<span class="w"> </span><span class="o">(</span>/usr/lib/systemd/system/firewalld.service<span class="p">;</span>enabled<span class="p">;</span><span class="w"> </span>vendor<span class="w"> </span>preset:<span class="w"> </span>enabled<span class="o">)</span>
<span class="w">            </span>Active:<span class="w"> </span>active<span class="w"> </span><span class="o">(</span>running<span class="o">)</span><span class="w"> </span>since<span class="w"> </span>Mon<span class="w"> </span><span class="m">2024</span>-06-23<span class="w"> </span><span class="m">10</span>:00:00<span class="w"> </span>-04<span class="p">;</span><span class="w"> </span>2h<span class="w"> </span>ago<span class="w"> </span>
<span class="w">            </span>Docs:<span class="w"> </span>man:firewalld<span class="o">(</span><span class="m">1</span><span class="o">)</span><span class="w"> </span>
<span class="w">            </span>Main<span class="w"> </span>PID:<span class="w"> </span><span class="m">1234</span><span class="w"> </span><span class="o">(</span>firewalld<span class="o">)</span><span class="w"> </span>Tasks:<span class="w"> </span><span class="m">2</span><span class="w"> </span><span class="o">(</span>limit:<span class="w"> </span><span class="m">1140</span><span class="o">)</span><span class="w"> </span>Memory:<span class="w"> </span><span class="m">10</span>.5M<span class="w"> </span>CPU:<span class="w"> </span>130ms<span class="w"> </span>
<span class="w">            </span>CGroup:<span class="w"> </span>/system.slice/firewalld.service<span class="w"> </span>
<span class="w">            </span>└─1234<span class="w"> </span>/usr/bin/python3<span class="w"> </span>-s<span class="w"> </span>/usr/sbin/firewalld<span class="w"> </span>--nofork<span class="w"> </span>--nopid
</code></pre></div>

<p>b) Usando firewall-cmd --state (más conciso):</p>
<p>Este comando es más simple y solo te dirá si el demonio de Firewalld está corriendo.</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--state<span class="sb">```</span>

Si<span class="w"> </span>está<span class="w"> </span>funcionando,<span class="w"> </span>la<span class="w"> </span>salida<span class="w"> </span>será<span class="w"> </span>**running**.<span class="w"> </span>Si<span class="w"> </span>no,<span class="w"> </span>mostrará<span class="w"> </span>**not<span class="w"> </span>running**.



<span class="m">2</span>.<span class="w"> </span>¿Cómo<span class="w"> </span>activar<span class="w"> </span>o<span class="w"> </span>desactivar<span class="w"> </span>Firewalld?

Para<span class="w"> </span>controlar<span class="w"> </span>Firewalld,<span class="w"> </span>usamos<span class="w"> </span>systemctl.<span class="w"> </span>Es<span class="w"> </span>importante<span class="w"> </span>diferenciar<span class="w"> </span>entre<span class="w"> </span>iniciar/detener<span class="w"> </span>el<span class="w"> </span>servicio<span class="w"> </span>en<span class="w"> </span>el<span class="w"> </span>momento<span class="w"> </span>y<span class="w"> </span>habilitarlo/deshabilitarlo<span class="w"> </span>para<span class="w"> </span>que<span class="w"> </span>se<span class="w"> </span>inicie<span class="w"> </span>con<span class="w"> </span>el<span class="w"> </span>sistema.

Para<span class="w"> </span>iniciar<span class="w"> </span>Firewalld<span class="w"> </span><span class="o">(</span>en<span class="w"> </span>la<span class="w"> </span>sesión<span class="w"> </span>actual<span class="o">)</span>:

<span class="sb">```</span>Bash<span class="w"> </span>
systemctl<span class="w"> </span>start<span class="w"> </span>firewalld<span class="sb">```</span>

Para<span class="w"> </span>detener<span class="w"> </span>Firewalld<span class="w"> </span><span class="o">(</span>en<span class="w"> </span>la<span class="w"> </span>sesión<span class="w"> </span>actual<span class="o">)</span>:

<span class="sb">```</span>Bash<span class="w"> </span>
systemctl<span class="w"> </span>stop<span class="w"> </span>firewalld<span class="sb">```</span>


**¡Cuidado!**<span class="w"> </span>Detener<span class="w"> </span>Firewalld<span class="w"> </span>dejará<span class="w"> </span>tu<span class="w"> </span>servidor<span class="w"> </span>sin<span class="w"> </span>la<span class="w"> </span>protección<span class="w"> </span>del<span class="w"> </span>firewall.

Para<span class="w"> </span>habilitar<span class="w"> </span>Firewalld<span class="w"> </span><span class="o">(</span>para<span class="w"> </span>que<span class="w"> </span>inicie<span class="w"> </span>automáticamente<span class="w"> </span>con<span class="w"> </span>el<span class="w"> </span>sistema<span class="o">)</span>:


<span class="sb">```</span>Bash<span class="w"> </span>
systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>firewalld<span class="sb">```</span>


Para<span class="w"> </span>deshabilitar<span class="w"> </span>Firewalld<span class="w"> </span><span class="o">(</span>para<span class="w"> </span>que<span class="w"> </span>NO<span class="w"> </span>inicie<span class="w"> </span>automáticamente<span class="w"> </span>con<span class="w"> </span>el<span class="w"> </span>sistema<span class="o">)</span>:

<span class="sb">```</span>Bash<span class="w"> </span>
systemctl<span class="w"> </span>disable<span class="w"> </span>firewalld<span class="sb">```</span>

<span class="c1">## Comandos básicos y listado de configuración</span>

Comencemos<span class="w"> </span>por<span class="w"> </span>verificar<span class="w"> </span>las<span class="w"> </span>zonas<span class="w"> </span>activas<span class="w"> </span>y<span class="w"> </span>las<span class="w"> </span>interfaces<span class="w"> </span>de<span class="w"> </span>red<span class="w"> </span>que<span class="w"> </span>tienen<span class="w"> </span>asignadas.<span class="w"> </span>Para<span class="w"> </span>ello,<span class="w"> </span>usamos<span class="w"> </span>el<span class="w"> </span>comando:


<span class="sb">```</span>Bash<span class="w"> </span>firewall-cmd<span class="w"> </span>--get-active-zones<span class="sb">```</span>
La<span class="w"> </span>salida<span class="w"> </span>será<span class="w"> </span>similar<span class="w"> </span>a<span class="w"> </span>esta:

<span class="sb">```</span>Bash
<span class="w">      </span>public:

<span class="w">          </span>interfaces:<span class="w"> </span>eth0
</code></pre></div>

<p>Esta salida nos indica que tenemos una zona activa llamada public y que la intefaz de red eth0 está asociada a ella.</p>
<p>Ahora, para tener una visión completa de todos los servicios, puertos y otras reglas configuradas en la zona public, utilizamos el siguiente comando:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--list-all<span class="w"> </span>
</code></pre></div>

<p>Obtendrás una salida detallada como esta:</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span>public<span class="w"> </span><span class="o">(</span>active<span class="o">)</span>

<span class="w">        </span>target:<span class="w"> </span>default
<span class="w">        </span>icmp-block-inversion:<span class="w"> </span>no
<span class="w">        </span>interfaces:<span class="w"> </span>eth0
<span class="w">        </span>sources:
<span class="w">        </span>services:<span class="w"> </span>dhcpv6-client<span class="w"> </span>ssh
<span class="w">        </span>ports:
<span class="w">        </span>protocols:
<span class="w">        </span>masquerade:<span class="w"> </span>no
<span class="w">        </span>forward-ports:
<span class="w">        </span>source-ports:
<span class="w">        </span>icmp-blocks:
<span class="w">        </span>rich-rules:
</code></pre></div>

<p>Como puedes observar, la zona public tiene asociada la interfaz eth0. En la sección services (servicios), vemos que el tráfico para dhcpv6-client y ssh está permitido. Nota que en la sección ports (puertos) no hay ningún puerto individualmente habilitado, ya que estos servicios usan sus puertos por defecto.</p>
<p>Ahora, habilitemos el tráfico para algunos servicios comunes en nuestra zona public. Agregaremos los servicios web (http y https) y ftp.</p>
<p>Para los servicios web (http  y https) usamos</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>http

<span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>https
</code></pre></div>

<p>y para el servicio FTP:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>ftp<span class="w"> </span>
</code></pre></div>

<p>Es una buena práctica eliminar servicios que no se usan. Por ejemplo, si tu servidor tiene una IP estática, es probable que no necesites el cliente DHCPv6. Para eliminarlo:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>dhcpv6-client
</code></pre></div>

<p>Si volvemos a listar la configuración completa de la zona public con <strong>firewall-cmd --zone=public --list-all</strong>, veras que la sección services ahora refleja estos cambios:</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span>public<span class="w"> </span><span class="o">(</span>active<span class="o">)</span>

<span class="w">         </span>...
<span class="w">         </span>services:<span class="w"> </span>ftp<span class="w"> </span>http<span class="w"> </span>https<span class="w"> </span>ssh
<span class="w">         </span>...
</code></pre></div>

<p>Como puedes ver, los servicios ftp, http, https y ssh ahora están listados en la sección services.</p>
<p>¿Eso es todo? ¡No, aún no hemos terminado!</p>
<p>Es importante entender que los cambios que hemos realizado hasta ahora con firewall-cmd son inmediatos y afecta la configuración en tiempo de ejecución (runtime). Esto significa que el tráfico para los servicios HTTP, HTTPS y FTP ya está permitido. Sin embargo, hay un detalle crucial: si reinicias el servidor, todos estos cambios se perderán y la configuración del firewall volverá a su estado anterior.</p>
<p>Para hacer que estas modificaciones sean permanentes y persistan después de un reinicio, tienes dos opciones:</p>
<ol>
<li>Guardar la configuración en ejecución a la configuración permanente:</li>
</ol>
<p>Una vez que estés satisfecho con los cambios que has hecho en tiempo de ejecución, puedes guardarlos explícitamente en la configuración permanente con este comando:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--runtime-to-permanent
</code></pre></div>

<p>Este comando copia todas las reglas activas actualmente a los archivos de configuración pemanente de Firewalld.</p>
<ol>
<li>Realizar los cambios directamente en la configuración permanente y luego recargar:</li>
</ol>
<p>La otra forma es añadir el argumento --permanent a cada comando que ejecutes. Esto indica a Firewalld que la modificacion se debe aplicar directamente a la configuración permanente, no solo a la configuración en ejecución.</p>
<div class="highlight"><pre><span></span><code><span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>http<span class="w"> </span>--permanent
<span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>https<span class="w"> </span>--permanent
<span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>ftp<span class="w"> </span>--permanent
<span class="w">      </span>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-service<span class="o">=</span>dhcpv6-client<span class="w"> </span>--permanent
</code></pre></div>

<p>**¡Importante! ** Cuando modificas la configuración permanente de esta manera, los cambios no se aplican inmediatamente al firewall en ejecución. Para que Firewalld active estas nuevas reglas, necesitas recargar el servicio:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--reload
</code></pre></div>

<p>Ten en cuenta que al ejecutar --reload, Firewall recarga su configuración y módulos asociados. Esto puede causar una breve interrupción en el tráfico que pasa por el firewall mientras se aplican las nuevas reglas. Por lo tanto, si realizas cambios en un servidor en producción, planifica este comando con precaución.</p>
<h2>Comandos útiles adicionales de Firewalld</h2>
<p>a. Obtener la lista de servicios predefinidos:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--get-services
</code></pre></div>

<p>La salida es una larga lista de servicios como esta (puede variar):</p>
<div class="highlight"><pre><span></span><code>RH-Satellite-6<span class="w"> </span>RH-Satellite-6-capsule<span class="w"> </span>amanda-client<span class="w"> </span>...<span class="w"> </span>dhcp<span class="w"> </span>...<span class="w"> </span>http<span class="w"> </span>https<span class="w"> </span>imap<span class="w"> </span>imaps<span class="w"> </span>...<span class="w"> </span>ldap...<span class="w"> </span>ntp<span class="w"> </span>nrpe...<span class="w"> </span>ssh...
</code></pre></div>

<p>b. Añadir una regla temporal (con timeout):
Ideal para pruebas, especialmente en servidores remotos. Puedes permitir un servicio o puerto por un tiempo limitado. Por ejemplo, para abrir SSH por 15 minutos.</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-service<span class="o">=</span>ssh<span class="w"> </span>--timeout<span class="o">=</span>15m
</code></pre></div>

<p>Después de 15 minutos, la regla se eliminará automáticamente.</p>
<p>c. Verificar la sintaxis de la configuración permanente:
Antes de recargar una configuración permanente, es buena idea verificar que no haya errores de sintaxis:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--check-config
</code></pre></div>

<p>d. Listar puertos permitidos en una zona:
Para ver solo los puertos que tienes abiertos en una zona específica (diferente de los servicios):</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--list-ports<span class="sb">```</span>

e.<span class="w"> </span>Añadir<span class="w"> </span>un<span class="w"> </span>puerto<span class="w"> </span>específico<span class="w"> </span>para<span class="w"> </span>tráfico<span class="w"> </span>entrante:
Si<span class="w"> </span>necesitas<span class="w"> </span>abrir<span class="w"> </span>un<span class="w"> </span>puerto<span class="w"> </span>que<span class="w"> </span>no<span class="w"> </span>está<span class="w"> </span>asociado<span class="w"> </span>a<span class="w"> </span>un<span class="w"> </span>servicio<span class="w"> </span>predefinido<span class="w"> </span><span class="o">(</span>ej.<span class="w"> </span>puerto<span class="w"> </span><span class="m">566</span><span class="w"> </span>con<span class="w"> </span>protocolo<span class="w"> </span>TCP<span class="o">)</span>:

<span class="sb">```</span>Bash<span class="w"> </span>
firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--add-port<span class="o">=</span><span class="m">566</span>/tcp
</code></pre></div>

<p>f. Bloquear/Eliminar un puerto específico:</p>
<p>Para cerrar un puerto que ya no necesitas:</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--zone<span class="o">=</span>public<span class="w"> </span>--remove-port<span class="o">=</span><span class="m">566</span>/tcp
</code></pre></div>

<p>g. Listar todas las zonas definidas en el sistema:</p>
<p>Para ver qué zonas están disponibles en tu sistema Firewalld (no solo las activas):</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--get-zones
</code></pre></div>

<p>Ejemplo de salida:</p>
<div class="highlight"><pre><span></span><code>block<span class="w"> </span>dmz<span class="w"> </span>drop<span class="w"> </span>external<span class="w"> </span>home<span class="w"> </span>internal<span class="w"> </span>public<span class="w"> </span>trusted<span class="w"> </span>work
</code></pre></div>

<p>Recordatorio importante para los comandos adicionales:</p>
<p>Recuerda que, al igual que con los servicios, si deseas que los cambios realizados con estos comandos sean permanentes, debes añadir el argumento --permanent a cada comando y luego recargar Firewalld con</p>
<div class="highlight"><pre><span></span><code>firewall-cmd<span class="w"> </span>--reload<span class="w"> </span>
</code></pre></div>

<p><strong>Referencias</strong>
* <a href="https://docs.redhat.com/es/documentation/red_hat_enterprise_linux/8/html/securing_networks/getting-started-with-firewalld_using-and-configuring-firewalld?sc_cid=RHCTL0250000446747&amp;gad_source=1&amp;gad_campaignid=22526228844&amp;gbraid=0AAAAADsbVMSknhD5zEODxuzLDvJspc2YY&amp;gclid=CjwKCAjwmenCBhA4EiwAtVjzms0-0VCl9vKw2AsttXG5BT8hbJpexA0w-pubAlaLFITLQkDlB02S7xoC1cMQAvD_BwE">Documentación de Red Hat</a></p>
<ul>
<li><a href="https://firewalld.org/">Página oficial de firewalld</a></li>
</ul>
      </div><!-- /.entry-content -->

    </article>
  </section>
                <section id="extras" class="body">
                                <div class="blogroll">
                                        <h2>links</h2>
                                        <ul>
                                                        <li><a href="https://getpelican.com/">Pelican</a></li>
                                                        <li><a href="https://www.python.org/">Python.org</a></li>
                                                        <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                                        </ul>
                                </div><!-- /.blogroll -->
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>

                                                        <li><a href="https://www.linkedin.com/in/xmonroy/">LinkedIn</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>